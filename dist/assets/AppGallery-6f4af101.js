import{d as _,z as n,a as e,j as s,F as g}from"./index-e29a207a.js";import{r as l}from"./react-vendor-84e09ada.js";import{f as w}from"./firebaseAppService-c49cb327.js";import{R as q,p as H,q as O,x as Y,I as J}from"./firebase-24a1fa17.js";import{R,n as K,G as Q,W as X,af as N,m as Z,as as u,az as F,a0 as E,am as ee}from"./ui-vendor-766bbeef.js";import"https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";import"./monaco-editor-bb996daf.js";import"./router-vendor-e414a864.js";const me=()=>{const[x,b]=l.useState([]),[d,B]=l.useState([]),[T,v]=l.useState(!0),[i,y]=l.useState(""),[m,z]=l.useState("grid"),[f,I]=l.useState("newest"),[h,k]=l.useState(null),[A,L]=l.useState(!1);l.useEffect(()=>{p(),V();let t=null;try{t=M()}catch(r){console.error("❌ Failed to setup real-time listener:",r)}const a=r=>{console.log("📡 App deployment event received:",r.detail),n.success(`New app "${r.detail.appName}" added to gallery!`,{duration:4e3,icon:"🚀"}),p(!0)};return window.addEventListener("appDeployed",a),()=>{t&&t(),window.removeEventListener("appDeployed",a)}},[]);const M=()=>{try{console.log("🔄 Setting up real-time listener for apps...");const t=q(H(_,"apps"),O("isPublic","==",!0),Y("createdAt","desc"));return J(t,r=>{console.log("📡 Real-time update received:",r.docs.length,"apps");const o=r.docs.map(c=>({id:c.id,...c.data()}));if(b(o),o.length>0){const c=o[0],P=new Date,W=c.createdAt?.toDate?.()||new Date(c.createdAt);P-W<3e4&&n.success(`New app "${c.name}" added to gallery!`,{duration:4e3,icon:"🚀"})}},r=>{console.error("❌ Real-time listener error:",r),console.log("🔄 Falling back to manual refresh due to permissions error"),n.error("Real-time updates disabled - use refresh button",{duration:3e3})})}catch(t){return console.error("❌ Error setting up real-time listener:",t),console.log("🔄 Real-time listener setup failed, using manual refresh only"),null}};l.useEffect(()=>{U()},[x,i,f]);const p=async(t=!1)=>{try{t?L(!0):v(!0),console.log("🔄 Loading apps from Firebase...");const a=await w.getPublicApps(50);if(console.log("✅ Loaded apps:",a.length),console.log("✅ Apps data:",a),b(a),a.length===0){console.log("⚠️ No public apps found in Firebase");const r=document.createElement("div");r.className="fixed top-20 left-4 bg-yellow-500 text-white px-4 py-2 rounded shadow-lg z-10",r.textContent="No apps found in Firebase",r.id="no-apps-debug",document.body.appendChild(r),setTimeout(()=>{const o=document.getElementById("no-apps-debug");o&&o.remove()},5e3)}}catch(a){console.error("❌ Error loading apps:",a),n.error("Failed to load apps"),b([])}finally{v(!1),L(!1)}},V=async()=>{try{console.log("🔄 Loading app stats from Firebase...");const t=await w.getAppStats();console.log("✅ Loaded stats:",t),k(t)}catch(t){console.error("❌ Error loading stats:",t),k({totalApps:0,publicApps:0,totalViews:0,totalLikes:0})}},U=()=>{let t=[...x];switch(i&&(t=t.filter(a=>a.name.toLowerCase().includes(i.toLowerCase())||a.tags.some(r=>r.toLowerCase().includes(i.toLowerCase())))),f){case"newest":t.sort((a,r)=>new Date(r.createdAt)-new Date(a.createdAt));break;case"popular":t.sort((a,r)=>(r.views||0)-(a.views||0));break;case"trending":t.sort((a,r)=>(r.likes||0)-(a.likes||0));break}B(t)},$=t=>{y(t.target.value)},G=t=>{I(t.target.value)},D=t=>{z(t)},S=t=>{navigator.share?navigator.share({title:t.name,url:t.url}):(navigator.clipboard.writeText(t.url),n.success("URL copied to clipboard!"))},C=async t=>{try{await w.toggleLike(t.id,"anonymous"),n.success("Liked!"),p()}catch{n.error("Failed to like app")}},j=t=>{if(!t)return"Unknown date";try{let a;return t&&typeof t=="object"&&t.toDate?a=t.toDate():t&&typeof t=="object"&&t.seconds?a=new Date(t.seconds*1e3):a=new Date(t),isNaN(a.getTime())?"Unknown date":a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(a){return console.error("Date formatting error:",a),"Unknown date"}};return T?e("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:s("div",{className:"text-center",children:[e("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e("h2",{className:"text-xl font-semibold text-gray-800",children:"Loading DreamBuild Apps..."})]})}):s("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e("div",{className:"bg-white shadow-sm border-b mt-16",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:s("div",{className:"text-center",children:[e("h1",{className:"text-3xl font-bold text-gray-900",children:"DreamBuild App Gallery"}),e("p",{className:"text-gray-600 mt-2",children:"Discover amazing apps created with DreamBuild AI"}),e("button",{onClick:()=>p(!0),disabled:A,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 flex items-center gap-2",children:A?s(g,{children:[e(R,{className:"h-4 w-4 animate-spin"}),"Refreshing..."]}):s(g,{children:[e(R,{className:"h-4 w-4"}),"Refresh Apps"]})})]})})}),h&&e("div",{className:"bg-white border-b",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:s("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s("div",{className:"text-center",children:[e("div",{className:"text-lg font-semibold text-gray-900",children:h.publicApps}),e("div",{className:"text-sm text-gray-500",children:"Public Apps"})]}),s("div",{className:"text-center",children:[e("div",{className:"text-lg font-semibold text-gray-900",children:h.totalViews}),e("div",{className:"text-sm text-gray-500",children:"Total Views"})]}),s("div",{className:"text-center",children:[e("div",{className:"text-lg font-semibold text-gray-900",children:h.totalLikes}),e("div",{className:"text-sm text-gray-500",children:"Total Likes"})]}),s("div",{className:"text-center",children:[e("div",{className:"text-lg font-semibold text-gray-900",children:d.length}),e("div",{className:"text-sm text-gray-500",children:"Filtered Results"})]})]})})}),e("div",{className:"bg-white border-b",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:s("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-center lg:justify-between",children:[s("div",{className:"relative w-full max-w-md mx-auto",children:[s("div",{className:"relative",children:[e("input",{type:"text",placeholder:"Search amazing apps...",value:i,onChange:$,className:"w-full pl-4 pr-12 py-3 bg-white border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 focus:outline-none transition-all duration-200 shadow-sm hover:shadow-md focus:shadow-lg"}),e(K,{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),i&&e("button",{onClick:()=>y(""),className:"absolute right-10 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:e("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i&&e("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:s("div",{className:"p-3 text-sm text-gray-600",children:[e("span",{className:"font-medium",children:d.length})," app",d.length!==1?"s":"",' found for "',e("span",{className:"font-medium text-blue-600",children:i}),'"']})})]}),s("div",{className:"flex items-center gap-4",children:[s("div",{className:"relative",children:[s("select",{value:f,onChange:G,className:"appearance-none px-4 py-3 pr-8 bg-white border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 focus:outline-none transition-all duration-200 shadow-sm hover:shadow-md focus:shadow-lg cursor-pointer",children:[e("option",{value:"newest",children:"🆕 Newest"}),e("option",{value:"popular",children:"🔥 Most Popular"}),e("option",{value:"trending",children:"📈 Trending"})]}),e("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),s("div",{className:"flex items-center gap-1 bg-gray-100 rounded-xl p-1",children:[e("button",{onClick:()=>D("grid"),className:`p-2 rounded-lg transition-all duration-200 ${m==="grid"?"bg-blue-500 text-white shadow-md":"text-gray-600 hover:bg-white hover:shadow-sm"}`,children:e(Q,{className:"h-4 w-4"})}),e("button",{onClick:()=>D("list"),className:`p-2 rounded-lg transition-all duration-200 ${m==="list"?"bg-blue-500 text-white shadow-md":"text-gray-600 hover:bg-white hover:shadow-sm"}`,children:e(X,{className:"h-4 w-4"})})]})]})]})})}),e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:d.length===0?e("div",{className:"text-center py-12",children:x.length===0?s(g,{children:[e("div",{className:"text-6xl mb-4",children:"🚀"}),e("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No apps yet"}),e("p",{className:"text-gray-600 mb-4",children:"Be the first to create an amazing app with DreamBuild AI!"}),s("a",{href:"/ai-builder",className:"inline-flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:[e("span",{children:"Create Your First App"}),e(N,{className:"h-4 w-4"})]})]}):s(g,{children:[e("div",{className:"text-6xl mb-4",children:"🔍"}),e("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No apps found"}),e("p",{className:"text-gray-600",children:"Try adjusting your search or filters"})]})}):e("div",{className:m==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:d.map(t=>e(Z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow ${m==="list"?"flex":""}`,children:m==="grid"?s("div",{className:"p-6",children:[s("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:t.name}),s("div",{className:"flex items-center gap-2",children:[e("button",{onClick:()=>C(t),className:"p-1 hover:bg-gray-100 rounded",children:e(u,{className:"h-4 w-4 text-gray-400"})}),e("button",{onClick:()=>S(t),className:"p-1 hover:bg-gray-100 rounded",children:e(F,{className:"h-4 w-4 text-gray-400"})})]})]}),e("div",{className:"mb-4",children:e("div",{className:"w-full h-32 bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center",children:s("div",{className:"text-center",children:[e("div",{className:"text-2xl mb-2",children:"🚀"}),e("div",{className:"text-sm text-gray-600",children:"DreamBuild App"})]})})}),s("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[s("div",{className:"flex items-center gap-4",children:[s("div",{className:"flex items-center gap-1",children:[e(E,{className:"h-4 w-4"}),e("span",{children:t.views||0})]}),s("div",{className:"flex items-center gap-1",children:[e(u,{className:"h-4 w-4"}),e("span",{children:t.likes||0})]})]}),s("div",{className:"flex items-center gap-1",children:[e(ee,{className:"h-4 w-4"}),e("span",{children:j(t.createdAt)})]})]}),t.tags&&t.tags.length>0&&e("div",{className:"flex flex-wrap gap-2 mb-4",children:t.tags.slice(0,3).map((a,r)=>e("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:a},r))}),s("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e(N,{className:"h-4 w-4"}),"View App"]})]}):e("div",{className:"p-6 flex-1",children:s("div",{className:"flex items-center justify-between",children:[s("div",{className:"flex-1",children:[e("h3",{className:"text-lg font-semibold text-gray-900",children:t.name}),s("p",{className:"text-gray-600 text-sm mt-1",children:["Created ",j(t.createdAt)]}),s("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[s("div",{className:"flex items-center gap-1",children:[e(E,{className:"h-4 w-4"}),s("span",{children:[t.views||0," views"]})]}),s("div",{className:"flex items-center gap-1",children:[e(u,{className:"h-4 w-4"}),s("span",{children:[t.likes||0," likes"]})]})]})]}),s("div",{className:"flex items-center gap-2",children:[e("button",{onClick:()=>C(t),className:"p-2 hover:bg-gray-100 rounded",children:e(u,{className:"h-4 w-4 text-gray-400"})}),e("button",{onClick:()=>S(t),className:"p-2 hover:bg-gray-100 rounded",children:e(F,{className:"h-4 w-4 text-gray-400"})}),s("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e(N,{className:"h-4 w-4"}),"View"]})]})]})})},t.id))})})]})};export{me as default};
