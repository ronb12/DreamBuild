<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/icons/icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DreamBuild - Universal AI Development Platform</title>
    <meta name="description" content="The world's most advanced AI-powered development platform supporting 100+ programming languages across all platforms and frameworks." />
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json?v=2.0.0" />
    <meta name="theme-color" content="#000000" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="DreamBuild" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="DreamBuild - Universal AI Development Platform" />
    <meta property="og:description" content="The world's most advanced AI-powered development platform supporting 100+ programming languages across all platforms and frameworks." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://dreambuild-2024-app.web.app" />
    <meta property="og:image" content="/icons/icon-512x512.png" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="DreamBuild - Universal AI Development Platform" />
    <meta name="twitter:description" content="The world's most advanced AI-powered development platform supporting 100+ programming languages across all platforms and frameworks." />
    <meta name="twitter:image" content="/icons/icon-512x512.png" />
    
    <!-- Preload critical resources -->
    <!-- <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin /> -->
    
    <!-- Critical CSS inline -->
    <style>
      /* Critical CSS for initial render */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8fafc;
      }
      
      #root {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      /* Loading spinner */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #f8fafc;
      }
      
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e2e8f0;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="loading">
        <div class="spinner"></div>
      </div>
    </div>
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
      import { getAuth, GoogleAuthProvider, GithubAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
      
      const firebaseConfig = {
        apiKey: "AIzaSyCWjBfZHPHDI4rXRStWPP48lRZVJquWH38",
        authDomain: "dreambuild-2024-app.firebaseapp.com",
        projectId: "dreambuild-2024-app",
        storageBucket: "dreambuild-2024-app.firebasestorage.app",
        messagingSenderId: "780467658601",
        appId: "1:780467658601:web:833a9373c15fa3be0be7f8"
      };
      
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      
      // Make Firebase available globally with all providers
      window.firebase = { 
        auth: () => auth,
        GoogleAuthProvider,
        GithubAuthProvider,
        signInWithPopup
      };
      window.firebaseApp = app;
      
      console.log('Firebase loaded globally with providers:', !!window.firebase);
    </script>
    
    <!-- Polyfills for missing APIs - MUST load before any modules -->
    <script>
      // Immediate polyfill loading - no IIFE to ensure synchronous execution
      console.log('ðŸ”§ Loading polyfills immediately...');
      
      // Ensure globalThis is available
      if (typeof globalThis === 'undefined') {
        window.globalThis = window;
      }
      
      // Polyfill for Headers API (must be first to avoid circular dependency)
      if (!window.Headers) {
        window.Headers = class Headers {
          constructor(init = {}) {
            this._headers = {};
            if (init) {
              Object.entries(init).forEach(([key, value]) => {
                this._headers[key.toLowerCase()] = value;
              });
            }
          }
          
          get(name) {
            return this._headers[name.toLowerCase()];
          }
          
          set(name, value) {
            this._headers[name.toLowerCase()] = value;
          }
          
          has(name) {
            return name.toLowerCase() in this._headers;
          }
        };
      }
      
      // Polyfill for Request API
      if (!window.Request) {
        window.Request = class Request {
          constructor(input, init = {}) {
            this.url = input;
            this.method = init.method || 'GET';
            this.headers = new window.Headers(init.headers || {});
            this.body = init.body;
          }
        };
      }
      
      // Polyfill for Response API
      if (!window.Response) {
        window.Response = class Response {
          constructor(body, init = {}) {
            this.body = body;
            this.status = init.status || 200;
            this.statusText = init.statusText || 'OK';
            this.headers = new window.Headers(init.headers || {});
          }
          
          async json() {
            return JSON.parse(this.body);
          }
          
          async text() {
            return this.body;
          }
        };
      }
      
      // Ensure fetch is available
      if (!window.fetch) {
        window.fetch = async function(url, options = {}) {
          const xhr = new XMLHttpRequest();
          return new Promise((resolve, reject) => {
            xhr.open(options.method || 'GET', url);
            
            if (options.headers) {
              Object.entries(options.headers).forEach(([key, value]) => {
                xhr.setRequestHeader(key, value);
              });
            }
            
            xhr.onload = function() {
              resolve(new window.Response(xhr.responseText, {
                status: xhr.status,
                statusText: xhr.statusText,
                headers: xhr.getAllResponseHeaders()
              }));
            };
            
            xhr.onerror = function() {
              reject(new Error('Network error'));
            };
            
            xhr.send(options.body);
          });
        };
      }
      
      // Ensure these are available on all global objects
      globalThis.Request = window.Request;
      globalThis.Headers = window.Headers;
      globalThis.Response = window.Response;
      globalThis.fetch = window.fetch;
      
      // Also ensure they're available on self for web workers
      if (typeof self !== 'undefined') {
        self.Request = window.Request;
        self.Headers = window.Headers;
        self.Response = window.Response;
        self.fetch = window.fetch;
      }
      
      console.log('âœ… Polyfills loaded:', {
        Request: !!window.Request,
        Headers: !!window.Headers,
        Response: !!window.Response,
        fetch: !!window.fetch
      });
    </script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('DreamBuild SW registered:', registration);
            })
            .catch(error => {
              console.log('DreamBuild SW registration failed:', error);
            });
        });
      }
    </script>
    
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>